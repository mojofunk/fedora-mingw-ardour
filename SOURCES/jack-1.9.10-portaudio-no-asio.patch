From 967a55a7a0329c152109c4bb35e0f8f2182ba3d0 Mon Sep 17 00:00:00 2001
From: Tim Mayberry <mojofunk@gmail.com>
Date: Mon, 30 Apr 2012 18:42:04 +1000
Subject: [PATCH 3/4] Allow portaudio driver to be compiled without ASIO
 support

---
 windows/portaudio/JackPortAudioDevices.cpp | 4 ++--
 windows/portaudio/JackPortAudioDriver.cpp  | 3 ++-
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/windows/portaudio/JackPortAudioDevices.cpp b/windows/portaudio/JackPortAudioDevices.cpp
index 64c5f79..686202e 100644
--- a/windows/portaudio/JackPortAudioDevices.cpp
+++ b/windows/portaudio/JackPortAudioDevices.cpp
@@ -208,7 +208,7 @@ int PortAudioDevices::GetOutputDeviceFromName(const char* devicename, PaDeviceIn
 
 int PortAudioDevices::GetPreferredBufferSize(PaDeviceIndex id)
 {
-#ifdef WIN32
+#if defined(WIN32) && defined(HAVE_ASIO)
     /* ASIO specific latency information */
     if (Pa_GetHostApiInfo(fDeviceInfo[id]->hostApi)->type == paASIO) {
         long minLatency, maxLatency, preferredLatency, granularity;
@@ -261,7 +261,7 @@ void PortAudioDevices::DisplayDevicesNames()
         jack_info("Max inputs                  = %d", fDeviceInfo[id]->maxInputChannels);
         jack_info("Max outputs                 = %d", fDeviceInfo[id]->maxOutputChannels);
         
-    #ifdef WIN32
+    #if defined(WIN32) && defined(HAVE_ASIO)
         /* ASIO specific latency information */
         if (Pa_GetHostApiInfo(fDeviceInfo[id]->hostApi)->type == paASIO) {
             long minLatency, maxLatency, preferredLatency, granularity;
diff --git a/windows/portaudio/JackPortAudioDriver.cpp b/windows/portaudio/JackPortAudioDriver.cpp
index d29f8cb..994c3f1 100644
--- a/windows/portaudio/JackPortAudioDriver.cpp
+++ b/windows/portaudio/JackPortAudioDriver.cpp
@@ -273,6 +273,7 @@ int JackPortAudioDriver::Attach()
 
         const char* alias;
 
+#if defined(HAVE_ASIO)
         if (fInputDevice != paNoDevice && fPaDevices->GetHostFromDevice(fInputDevice) == "ASIO") {
             for (int i = 0; i < fCaptureChannels; i++) {
                 if (PaAsio_GetInputChannelName(fInputDevice, i, &alias) == paNoError) {
@@ -290,7 +291,7 @@ int JackPortAudioDriver::Attach()
                 }
             }
         }
-
+#endif
         return 0;
 
     } else {
-- 
1.8.3.1

